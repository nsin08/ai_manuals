name: Epic/Story Tracking

on:
  issues:
    types: [opened, edited, labeled, closed]

permissions:
  issues: write
  contents: read

jobs:
  track-hierarchy:
    runs-on: ubuntu-latest
    steps:
      - name: Track issue hierarchy
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const labels = issue.labels.map(l => l.name);
            const body = issue.body || '';
            
            // Check for type labels
            const isEpic = labels.includes('type:epic');
            const isStory = labels.includes('type:story');
            
            if (isEpic) {
              console.log(`✅ Epic tracked: #${issue.number}`);
            }
            
            if (isStory) {
              // Extract parent Epic reference
              const parentMatch = body.match(/(Parent|Epic):\s*#(\d+)/i);
              if (parentMatch) {
                const epicNumber = parentMatch[2];
                console.log(`✅ Story #${issue.number} → Epic #${epicNumber}`);
              }
            }
