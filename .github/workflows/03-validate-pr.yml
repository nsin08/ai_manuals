name: Validate Issue Links

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check PR links an issue
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          if ! echo "$PR_BODY" | grep -iE "closes|resolves|fixes" | grep -oE "#[0-9]+"; then
            echo "❌ PR must link to an issue (use 'Closes #123', 'Resolves #456', or 'Fixes #789')"
            exit 1
          fi
          echo "✅ PR is linked to an issue"
      
      - name: Check evidence mapping table
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          if ! echo "$PR_BODY" | grep -q "| Criterion"; then
            echo "⚠️  Warning: PR body should include evidence mapping table"
            echo "   Format: | Criterion | Test | Location | Status |"
          else
            echo "✅ Evidence mapping table found"
          fi
